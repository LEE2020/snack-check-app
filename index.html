<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="description" content="拍照识别零食，查询糖尿病患者能否食用">
  <meta name="theme-color" content="#2d6a4f">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="糖友助手">
  <title>糖友零食助手 - 拍照识食物</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app">
    <header>
      <h1>糖友零食助手</h1>
      <p class="tagline">拍照识别 · 安心选择</p>
    </header>

    <main>
      <section class="upload-section">
        <div class="preview-box" id="previewBox">
          <img id="previewImg" alt="预览" />
          <div class="placeholder" id="placeholder">
            <span class="icon">📷</span>
            <p>点击下方按钮拍照或上传图片</p>
          </div>
        </div>

        <div class="actions">
          <button type="button" class="btn btn-camera" id="btnCamera">
            拍照
          </button>
          <button type="button" class="btn btn-upload" id="btnUpload">
            从相册选择
          </button>
          <input type="file" id="fileInput" accept="image/*" capture="environment" hidden />
        </div>
      </section>

      <section class="result-section" id="resultSection" hidden>
        <div class="result-card" id="resultCard">
          <div class="result-badge" id="resultBadge">建议</div>

          <div class="result-block result-ingredients" id="resultIngredientsBlock">
            <h3 class="result-block-title">成分说明（图中识别内容）</h3>
            <pre id="resultSnippet" class="result-snippet"></pre>
          </div>

          <div class="result-block result-conclusion">
            <h3 class="result-block-title">分析结论</h3>
            <p id="resultSugarLevel" class="result-sugar-level"></p>
            <p id="resultPortion" class="result-portion"></p>
            <p id="resultAdvice" class="result-advice"></p>
            <p id="resultReason" class="result-reason"></p>
          </div>
        </div>
      </section>

      <section class="loading" id="loading" hidden>
        <div class="spinner"></div>
        <p id="loadingText">正在识别图中文字...</p>
      </section>

      <div class="disclaimer">
        <p>本结果仅供参考，不能替代医生建议。请以医嘱和产品配料表为准。</p>
      </div>
    </main>
  </div>

  <video id="cameraVideo" autoplay playsinline muted style="display:none;"></video>
  <canvas id="cameraCanvas" style="display:none;"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <script src="nutrition-analyze.js"></script>
  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(function () {});
    }
  </script>
</body>
</html>
